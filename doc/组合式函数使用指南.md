# 组合式函数使用指南

本文档介绍了项目中新增的组合式函数的使用方法和功能特性。

## 概述

项目已完成组合式函数架构的重构，新增了以下核心功能：

- **事件系统** (`useEventBus`) - 统一的事件管理
- **键盘快捷键** (`useKeyboard`) - 全局快捷键管理
- **通知系统** (`useNotification`) - 统一的通知管理

## 事件系统 (useEventBus)

### 基本用法

```typescript
import { useEventBus, EVENTS } from '@/composables'

const { on, off, emit, once } = useEventBus()

// 监听事件
on('custom-event', (data) => {
  console.log('接收到事件:', data)
})

// 触发事件
emit('custom-event', { message: 'Hello World' })

// 一次性监听
once('one-time-event', (data) => {
  console.log('只会执行一次:', data)
})

// 移除监听
off('custom-event', handler)
```

### 预定义事件

```typescript
// 系统事件
EVENTS.SYSTEM_READY      // 系统就绪
EVENTS.SYSTEM_ERROR      // 系统错误

// 应用事件
EVENTS.APP_OPENED        // 应用打开
EVENTS.APP_CLOSED        // 应用关闭
EVENTS.APP_MINIMIZED     // 应用最小化

// 用户事件
EVENTS.USER_LOGIN        // 用户登录
EVENTS.USER_LOGOUT       // 用户登出

// 主题事件
EVENTS.THEME_CHANGED     // 主题变化
```

## 键盘快捷键 (useKeyboard)

### 基本用法

```typescript
import { useKeyboard, COMMON_SHORTCUTS } from '@/composables'

const { register, unregister, isRegistered } = useKeyboard()

// 注册快捷键
register({
  key: 's',
  ctrl: true,
  description: '保存文件',
  handler: () => {
    console.log('保存文件')
  }
})

// 使用预定义快捷键
register(COMMON_SHORTCUTS.COPY, () => {
  console.log('复制')
})

// 检查快捷键是否已注册
if (isRegistered('ctrl+s')) {
  console.log('Ctrl+S 已注册')
}

// 注销快捷键
unregister('ctrl+s')
```

### 快捷键配置

```typescript
interface ShortcutConfig {
  key: string                    // 主键
  ctrl?: boolean                 // Ctrl 修饰键
  alt?: boolean                  // Alt 修饰键
  shift?: boolean                // Shift 修饰键
  meta?: boolean                 // Meta 修饰键 (Cmd/Win)
  description?: string           // 描述
  preventDefault?: boolean       // 阻止默认行为
  stopPropagation?: boolean      // 阻止事件冒泡
}
```

### 预定义快捷键

```typescript
COMMON_SHORTCUTS.COPY          // Ctrl+C
COMMON_SHORTCUTS.PASTE         // Ctrl+V
COMMON_SHORTCUTS.CUT           // Ctrl+X
COMMON_SHORTCUTS.UNDO          // Ctrl+Z
COMMON_SHORTCUTS.REDO          // Ctrl+Y
COMMON_SHORTCUTS.SELECT_ALL    // Ctrl+A
COMMON_SHORTCUTS.SAVE          // Ctrl+S
COMMON_SHORTCUTS.FIND          // Ctrl+F
COMMON_SHORTCUTS.REFRESH       // Ctrl+R
COMMON_SHORTCUTS.CLOSE_WINDOW  // Ctrl+W
COMMON_SHORTCUTS.SPOTLIGHT     // Ctrl+Space
```

## 通知系统 (useNotification)

### 基本用法

```typescript
import { useNotification, notify } from '@/composables'

const { success, error, warning, info, clear } = useNotification()

// 快捷方法
success('操作成功！')
error('操作失败！')
warning('请注意！')
info('提示信息')

// 全局快捷方法
notify.success('全局成功通知')

// 自定义通知
notify({
  type: 'success',
  title: '自定义标题',
  message: '自定义消息',
  duration: 5000,
  position: 'top-right',
  actions: [
    {
      label: '确认',
      handler: () => console.log('确认')
    },
    {
      label: '取消',
      handler: () => console.log('取消')
    }
  ]
})

// 清除通知
clear()                    // 清除所有
clear('success')           // 清除指定类型
clear('top-right')         // 清除指定位置
```

### 通知配置

```typescript
interface NotificationConfig {
  type?: NotificationType           // 类型: success | error | warning | info
  title?: string                    // 标题
  message: string                   // 消息内容
  duration?: number                 // 显示时长 (0 = 不自动关闭)
  position?: NotificationPosition   // 位置
  html?: boolean                    // 是否支持 HTML
  actions?: NotificationAction[]    // 操作按钮
  onClose?: () => void             // 关闭回调
}
```

### 通知位置

```typescript
'top-left'     // 左上角
'top-right'    // 右上角 (默认)
'bottom-left'  // 左下角
'bottom-right' // 右下角
'top-center'   // 顶部居中
'bottom-center'// 底部居中
```

## 系统集成

### 在组件中使用

```vue
<template>
  <div>
    <button @click="handleSave">保存 (Ctrl+S)</button>
    <button @click="showNotification">显示通知</button>
  </div>
</template>

<script setup>
import { onMounted, onUnmounted } from 'vue'
import { 
  useEventBus, 
  useKeyboard, 
  useNotification,
  EVENTS 
} from '@/composables'

const { on, off, emit } = useEventBus()
const { register, unregister } = useKeyboard()
const { success } = useNotification()

const handleSave = () => {
  // 保存逻辑
  success('保存成功！')
  emit(EVENTS.APP_SAVED, { timestamp: Date.now() })
}

const showNotification = () => {
  success('这是一个成功通知！', {
    title: '操作完成',
    duration: 3000
  })
}

onMounted(() => {
  // 注册快捷键
  register({
    key: 's',
    ctrl: true,
    description: '保存',
    handler: handleSave
  })
  
  // 监听事件
  on(EVENTS.APP_SAVED, (data) => {
    console.log('应用已保存:', data)
  })
})

onUnmounted(() => {
  // 清理资源
  unregister('ctrl+s')
  off(EVENTS.APP_SAVED)
})
</script>
```

## 测试功能

项目中已集成开发者工具页面，可以通过以下方式访问：

1. 点击桌面左上角的苹果图标
2. 选择"开发者工具"菜单项
3. 在弹出的测试页面中体验各种功能

测试页面包含：
- 事件系统测试
- 键盘快捷键测试
- 通知系统测试
- 系统信息显示

## 最佳实践

### 1. 事件命名

```typescript
// 推荐：使用命名空间
'app:opened'
'user:login'
'theme:changed'

// 或使用预定义常量
EVENTS.APP_OPENED
EVENTS.USER_LOGIN
EVENTS.THEME_CHANGED
```

### 2. 快捷键管理

```typescript
// 在组件挂载时注册
onMounted(() => {
  register(shortcutConfig, handler)
})

// 在组件卸载时清理
onUnmounted(() => {
  unregister(shortcutKey)
})
```

### 3. 通知使用

```typescript
// 用户操作反馈
success('操作成功')
error('操作失败，请重试')

// 系统状态提示
info('正在加载...')
warning('网络连接不稳定')

// 重要操作确认
notify({
  type: 'warning',
  title: '确认删除',
  message: '此操作不可撤销',
  duration: 0,
  actions: [
    { label: '确认', handler: confirmDelete },
    { label: '取消', handler: cancelDelete }
  ]
})
```

## 注意事项

1. **内存管理**：记得在组件卸载时清理事件监听器和快捷键
2. **事件命名**：使用有意义的事件名称，避免冲突
3. **快捷键冲突**：注册前检查是否已存在相同快捷键
4. **通知数量**：避免同时显示过多通知，影响用户体验
5. **性能考虑**：频繁的事件触发可能影响性能，适当使用防抖节流

## 扩展开发

如需扩展功能，可以：

1. 在 `useEventBus.ts` 中添加新的事件类型
2. 在 `useKeyboard.ts` 中添加新的预定义快捷键
3. 在 `useNotification.ts` 中添加新的通知类型或样式
4. 创建新的组合式函数并在 `composables/index.ts` 中导出

通过这些组合式函数，可以构建更加模块化、可维护的应用程序。